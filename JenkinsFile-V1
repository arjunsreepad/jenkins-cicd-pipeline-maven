pipeline{
    agent    any    

    
    stages{
        // Clone from Git
        stage("Clone App from Git"){
            steps{
                echo "====++++  Clone App from Git ++++===="
                git branch:"main", url: "https://github.com/arjunsreepad/jenkins-cicd-pipeline-maven.git"
            }          
        }
        // Build and Unit Test (Maven/JUnit)
        stage("Build and Unit Test (Maven/JUnit)"){
            steps{
                echo "====++++  Build and Unit Test (Maven/JUnit) ++++===="

             //   withMaven {
                sh "mvn clean package"
                junit '**/target/surefire-reports/TEST-*.xml' // Archive the test reports
          //  }          
          }
        }
        
                stage("Static Code Analysis (SonarQube)"){
            steps{
                echo "====++++  Static Code Analysis (SonarQube) ++++===="
                   sh "mvn clean package clean package -Dsurefire.skip=true sonar:sonar -Dsonar.host.url=http://localhost:9000 -Dsonar.login=admin -Dsonar.password=admin@123  -Dsonar.projectName=08-jenkins-cicd-pipeline-maven-02-continious-delivery -Dsonar.projectKey=08-jenkins-cicd-pipeline-maven-02-continious-delivery -Dsonar.projectVersion=$BUILD_NUMBER";
               
               sh "docker build -t my-tomcat-app ."
               sh "docker run -p 8888:8888 my-tomcat-app"
               
            }           
        }
        
        
        
    }}
